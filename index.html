<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çince Çalışma Sistemi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React ve ReactDOM -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Özel Fontlar -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');
        
        .font-serif { font-family: 'Noto Serif SC', serif; }
        .font-kaiti { font-family: "KaiTi", "STKaiti", "BiauKai", "Times New Roman", serif; }
        .style-preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }
        
        /* Animasyonlar */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BookOpen, Layers, CheckCircle, Volume2, HelpCircle, PenTool, Search, ExternalLink, Upload, Database } from 'lucide-react';

        const ChineseStudySystem = () => {
            const [activeTab, setActiveTab] = useState('flashcards');

            // --- SESLENDİRME ---
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'zh-CN';
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }
            };

            // --- SABİT TEMEL VERİLER (Başlangıç İçin) ---
            const vocabulary = [
                { id: 1, hanzi: "我", pinyin: "wǒ", meaning: "Ben", example: "我是学生" },
                { id: 2, hanzi: "你", pinyin: "nǐ", meaning: "Sen", example: "你好" },
                { id: 3, hanzi: "是", pinyin: "shì", meaning: "Olmak (to be)", example: "他是老师" },
                { id: 4, hanzi: "老师", pinyin: "lǎoshī", meaning: "Öğretmen", example: "王老师" },
                { id: 5, hanzi: "学生", pinyin: "xuésheng", meaning: "Öğrenci", example: "我们是学生" },
                { id: 6, hanzi: "人", pinyin: "rén", meaning: "İnsan", example: "中国人" }
            ];

            const sentences = [
                { id: 1, turkish: "Ben öğretmenim.", blocks: ["我", "是", "老师"], pinyin: "Wǒ shì lǎoshī." },
                { id: 2, turkish: "Sen öğrenci misin?", blocks: ["你", "是", "学生", "吗", "?"], pinyin: "Nǐ shì xuésheng ma?" },
                { id: 3, turkish: "Onun adı ne?", blocks: ["他", "叫", "什么", "名字", "?"], pinyin: "Tā jiào shénme míngzi?" },
                { id: 4, turkish: "Benim kitabım yok.", blocks: ["我", "没有", "书"], pinyin: "Wǒ méiyǒu shū." }
            ];

            // --- FLASHCARD BİLEŞENİ ---
            const Flashcards = () => {
                const [currentIndex, setCurrentIndex] = useState(0);
                const [isFlipped, setIsFlipped] = useState(false);

                const nextCard = () => { setIsFlipped(false); setCurrentIndex((prev) => (prev + 1) % vocabulary.length); };
                const prevCard = () => { setIsFlipped(false); setCurrentIndex((prev) => (prev - 1 + vocabulary.length) % vocabulary.length); };
                const currentCard = vocabulary[currentIndex];

                return (
                    <div className="flex flex-col items-center justify-center space-y-6 animate-fadeIn">
                        <div className="text-center mb-2"><span className="text-sm font-medium text-gray-500">Kart {currentIndex + 1} / {vocabulary.length}</span></div>
                        <div onClick={() => setIsFlipped(!isFlipped)} className={`relative w-72 h-80 cursor-pointer transition-all duration-500 transform style-preserve-3d ${isFlipped ? 'rotate-y-180' : ''}`} style={{ perspective: '1000px' }}>
                            <div className={`absolute w-full h-full bg-white rounded-2xl shadow-xl border border-gray-200 flex flex-col items-center justify-center p-6 backface-hidden ${isFlipped ? 'hidden' : 'flex'}`}>
                                <span className="text-8xl font-serif text-indigo-600 mb-6">{currentCard.hanzi}</span>
                                <button onClick={(e) => { e.stopPropagation(); speak(currentCard.hanzi); }} className="p-3 bg-indigo-100 hover:bg-indigo-200 rounded-full text-indigo-700 transition"><Volume2 size={24} /></button>
                                <span className="text-gray-400 text-xs mt-4">Çevirmek için tıkla</span>
                            </div>
                            <div className={`absolute w-full h-full bg-indigo-50 rounded-2xl shadow-xl border border-indigo-100 flex flex-col items-center justify-center p-6 ${isFlipped ? 'flex' : 'hidden'}`}>
                                <div className="flex items-center gap-2 mb-2"><span className="text-4xl font-bold text-gray-800">{currentCard.pinyin}</span><button onClick={(e) => { e.stopPropagation(); speak(currentCard.hanzi); }} className="p-2 bg-white rounded-full text-indigo-600 shadow-sm"><Volume2 size={20} /></button></div>
                                <span className="text-xl text-gray-600 font-medium mb-6">{currentCard.meaning}</span>
                                <div className="bg-white p-3 rounded-lg w-full text-center shadow-sm"><p className="text-xs text-gray-400 uppercase tracking-wider mb-1">Örnek</p><div className="flex justify-center items-center gap-2"><p className="text-indigo-700 text-lg">{currentCard.example}</p><button onClick={(e) => { e.stopPropagation(); speak(currentCard.example); }} className="text-indigo-400 hover:text-indigo-600"><Volume2 size={16} /></button></div></div>
                            </div>
                        </div>
                        <div className="flex space-x-4 mt-4"><button onClick={prevCard} className="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-full font-medium transition">Önceki</button><button onClick={nextCard} className="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full font-medium transition">Sonraki</button></div>
                    </div>
                );
            };

            // --- CÜMLE KURMA BİLEŞENİ ---
            const SentenceBuilder = () => {
                const [currentSentIndex, setCurrentSentIndex] = useState(0);
                const [userBlocks, setUserBlocks] = useState([]);
                const [availableBlocks, setAvailableBlocks] = useState([]);
                const [status, setStatus] = useState('idle');

                useEffect(() => {
                    const blocks = [...sentences[currentSentIndex].blocks];
                    for (let i = blocks.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [blocks[i], blocks[j]] = [blocks[j], blocks[i]];
                    }
                    setAvailableBlocks(blocks);
                    setUserBlocks([]);
                    setStatus('idle');
                }, [currentSentIndex]);

                const handleBlockClick = (block, index, type) => {
                    if (status === 'correct') return;
                    if (type === 'available') {
                        const newAvailable = [...availableBlocks]; newAvailable.splice(index, 1);
                        setAvailableBlocks(newAvailable); setUserBlocks([...userBlocks, block]);
                    } else {
                        const newUser = [...userBlocks]; newUser.splice(index, 1);
                        setUserBlocks(newUser); setAvailableBlocks([...availableBlocks, block]);
                    }
                    setStatus('idle');
                };

                const checkAnswer = () => {
                    if (sentences[currentSentIndex].blocks.join('') === userBlocks.join('')) {
                        setStatus('correct'); speak(userBlocks.join(''));
                    } else setStatus('wrong');
                };

                return (
                    <div className="max-w-2xl mx-auto animate-fadeIn">
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <div className="text-center mb-8">
                                <h3 className="text-gray-500 text-sm font-semibold uppercase tracking-wider mb-2">Türkçe Cümle</h3>
                                <p className="text-2xl font-bold text-gray-800">{sentences[currentSentIndex].turkish}</p>
                            </div>
                            <div className={`min-h-[80px] border-2 border-dashed rounded-xl p-4 flex flex-wrap gap-2 justify-center items-center mb-6 transition-colors ${status === 'correct' ? 'border-green-400 bg-green-50' : status === 'wrong' ? 'border-red-400 bg-red-50' : 'border-gray-300 bg-gray-50'}`}>
                                {userBlocks.length === 0 && <span className="text-gray-400 italic">Kelimeleri buraya diz...</span>}
                                {userBlocks.map((block, idx) => (<button key={idx} onClick={() => handleBlockClick(block, idx, 'user')} className="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 text-xl font-serif transition transform active:scale-95">{block}</button>))}
                            </div>
                            <div className="flex flex-wrap gap-3 justify-center mb-8">
                                {availableBlocks.map((block, idx) => (<button key={idx} onClick={() => handleBlockClick(block, idx, 'available')} className="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg shadow-sm hover:bg-gray-100 text-xl font-serif transition">{block}</button>))}
                            </div>
                            <div className="flex justify-center space-x-4">
                                {status === 'correct' ? (
                                    <div className="flex gap-4"><button onClick={() => speak(sentences[currentSentIndex].blocks.join(''))} className="px-4 py-3 bg-indigo-100 text-indigo-700 hover:bg-indigo-200 rounded-full font-bold transition flex items-center gap-2"><Volume2 size={20} /><span>Dinle</span></button><button onClick={() => setCurrentSentIndex((prev) => (prev + 1) % sentences.length)} className="flex items-center space-x-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-full font-bold transition animate-bounce"><span>Sonraki</span><CheckCircle size={20} /></button></div>
                                ) : (
                                    <button onClick={checkAnswer} className="px-8 py-3 bg-gray-800 hover:bg-gray-900 text-white rounded-full font-bold transition">Kontrol Et</button>
                                )}
                            </div>
                            {status === 'correct' && <div className="mt-4 text-center text-green-600 font-medium">Pinyin: {sentences[currentSentIndex].pinyin}</div>}
                        </div>
                    </div>
                );
            };

            // --- QUIZ BİLEŞENİ ---
            const Quiz = () => {
                const [currentQIndex, setCurrentQIndex] = useState(0);
                const [options, setOptions] = useState([]);
                const [isAnswered, setIsAnswered] = useState(false);
                const [selectedOption, setSelectedOption] = useState(null);
                const [score, setScore] = useState(0);

                useEffect(() => {
                    const correct = vocabulary[currentQIndex];
                    const wrong = vocabulary.filter(v => v.id !== correct.id).sort(() => 0.5 - Math.random()).slice(0, 3);
                    setOptions([correct, ...wrong].sort(() => 0.5 - Math.random()));
                    setIsAnswered(false); setSelectedOption(null);
                }, [currentQIndex]);

                const handleOptionClick = (option) => {
                    if (isAnswered) return;
                    setSelectedOption(option); setIsAnswered(true);
                    if (option.id === vocabulary[currentQIndex].id) { setScore(s => s + 1); speak(option.hanzi); }
                };

                return (
                    <div className="max-w-md mx-auto bg-white rounded-xl shadow-lg overflow-hidden animate-fadeIn">
                        <div className="bg-indigo-600 p-6 text-center">
                            <h3 className="text-white text-lg font-medium opacity-80 mb-1">Bu Pinyin hangi karaktere ait?</h3>
                            <div className="flex items-center justify-center gap-3"><h2 className="text-4xl font-bold text-white tracking-wide">{vocabulary[currentQIndex].pinyin}</h2><button onClick={() => speak(vocabulary[currentQIndex].hanzi)} className="bg-white/20 p-2 rounded-full hover:bg-white/30 text-white"><Volume2 size={24} /></button></div>
                        </div>
                        <div className="p-6 grid grid-cols-2 gap-4">
                            {options.map((opt, idx) => (
                                <button key={idx} onClick={() => handleOptionClick(opt)} className={`h-24 text-4xl font-serif rounded-xl border-2 transition flex items-center justify-center ${isAnswered ? (opt.id === vocabulary[currentQIndex].id ? 'bg-green-100 border-green-500 text-green-700' : (opt.id === selectedOption?.id ? 'bg-red-100 border-red-500 text-red-700' : 'opacity-50')) : 'hover:border-indigo-400 hover:bg-indigo-50'}`}>{opt.hanzi}</button>
                            ))}
                        </div>
                        {isAnswered && <div className="px-6 pb-6"><button onClick={() => { if (currentQIndex < vocabulary.length - 1) setCurrentQIndex(i => i + 1); else { alert(`Bitti! Skor: ${score}`); setCurrentQIndex(0); setScore(0); }}} className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold">Sonraki Soru</button></div>}
                    </div>
                );
            };

            // --- GELİŞMİŞ HSK SÖZLÜK BİLEŞENİ (Dosya Yüklemeli) ---
            const HSKDictionary = () => {
                const [hskData, setHskData] = useState([]);
                const [searchTerm, setSearchTerm] = useState("");
                const [selectedChar, setSelectedChar] = useState(null);
                const [loading, setLoading] = useState(false);
                const [error, setError] = useState(null);

                // Otomatik Yükleme Denemesi
                useEffect(() => {
                    const tryAutoLoad = async () => {
                        try {
                            setLoading(true);
                            const response = await fetch('hsk-1-6-en.csv.json');
                            if (!response.ok) throw new Error("Dosya bulunamadı");
                            const data = await response.json();
                            processData(data);
                        } catch (err) {
                            console.log("Otomatik yükleme yapılamadı, manuel seçim bekleniyor.");
                            setLoading(false);
                        }
                    };
                    tryAutoLoad();
                }, []);

                const processData = (data) => {
                    if (data && data.hsk16) {
                        const formatted = data.hsk16.map((item, index) => ({
                            id: index,
                            hanzi: item.hanzi,
                            pinyin: item.pinyin,
                            meaning: item.translation,
                            level: "Tümü", // JSON'da seviye net değilse
                            strokes: "?"
                        }));
                        setHskData(formatted);
                        setLoading(false);
                        setError(null);
                    } else {
                        setError("JSON formatı geçersiz (hsk16 dizisi bulunamadı).");
                        setLoading(false);
                    }
                };

                const handleFileUpload = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const json = JSON.parse(e.target.result);
                            processData(json);
                        } catch (err) {
                            setError("Dosya okunamadı. Geçerli bir JSON olduğundan emin olun.");
                        }
                    };
                    reader.readAsText(file);
                };

                const filteredData = useMemo(() => {
                    if (!searchTerm) return hskData.slice(0, 100); // İlk 100 göster
                    const lowerTerm = searchTerm.toLowerCase();
                    return hskData.filter(item => 
                        item.hanzi.includes(lowerTerm) || 
                        item.pinyin.toLowerCase().includes(lowerTerm) ||
                        (item.meaning && item.meaning.toLowerCase().includes(lowerTerm))
                    ).slice(0, 50); // Arama sonuçlarını sınırla
                }, [hskData, searchTerm]);

                return (
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 animate-fadeIn">
                        {/* Sol Panel: Liste ve Arama */}
                        <div className="md:col-span-1 bg-white rounded-xl shadow-lg p-4 h-[600px] flex flex-col">
                            {/* Dosya Yükleme Alanı (Veri yoksa görünür) */}
                            {hskData.length === 0 && (
                                <div className="mb-4 p-4 border-2 border-dashed border-indigo-300 rounded-lg bg-indigo-50 text-center">
                                    <Database className="mx-auto text-indigo-500 mb-2" size={32} />
                                    <p className="text-sm text-indigo-800 font-medium mb-2">Veri Seti Yükle</p>
                                    <p className="text-xs text-indigo-600 mb-3">"hsk-1-6-en.csv.json" dosyasını seçin</p>
                                    <label className="cursor-pointer bg-indigo-600 text-white px-4 py-2 rounded-md text-sm hover:bg-indigo-700 transition inline-block">
                                        <div className="flex items-center gap-2">
                                            <Upload size={16} />
                                            <span>Dosya Seç</span>
                                        </div>
                                        <input type="file" accept=".json" onChange={handleFileUpload} className="hidden" />
                                    </label>
                                    {loading && <p className="text-xs text-gray-500 mt-2">Yükleniyor...</p>}
                                    {error && <p className="text-xs text-red-500 mt-2">{error}</p>}
                                </div>
                            )}

                            {hskData.length > 0 && (
                                <>
                                    <div className="relative mb-4">
                                        <Search className="absolute left-3 top-2.5 text-gray-400" size={18} />
                                        <input 
                                            type="text" 
                                            placeholder="Ara (Pinyin, Hanzi, Anlam...)" 
                                            className="w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none text-sm"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                        <div className="text-xs text-right text-gray-400 mt-1">{hskData.length} kelime yüklendi</div>
                                    </div>

                                    <div className="flex-1 overflow-y-auto space-y-2 pr-2 custom-scrollbar">
                                        {filteredData.map((item, idx) => (
                                            <div 
                                                key={idx}
                                                onClick={() => setSelectedChar(item)}
                                                className={`p-3 rounded-lg flex justify-between items-center cursor-pointer transition ${selectedChar?.hanzi === item.hanzi ? 'bg-indigo-50 border-l-4 border-indigo-600' : 'hover:bg-gray-50 border border-transparent'}`}
                                            >
                                                <div>
                                                    <span className="text-xl font-serif text-gray-800 mr-3">{item.hanzi}</span>
                                                    <span className="text-sm text-gray-500 font-medium">{item.pinyin}</span>
                                                </div>
                                                <span className="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded truncate max-w-[100px]">{item.meaning}</span>
                                            </div>
                                        ))}
                                        {filteredData.length === 0 && <div className="text-center text-gray-400 py-10 text-sm">Sonuç bulunamadı.</div>}
                                    </div>
                                </>
                            )}
                        </div>

                        {/* Sağ Panel: Detay */}
                        <div className="md:col-span-2 bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center min-h-[600px] relative">
                            {selectedChar ? (
                                <div className="w-full flex flex-col items-center animate-fadeIn">
                                    <div className="absolute top-6 right-6 flex gap-2">
                                        <button onClick={() => speak(selectedChar.hanzi)} className="p-2 bg-indigo-50 text-indigo-600 rounded-full hover:bg-indigo-100" title="Dinle"><Volume2 size={24}/></button>
                                    </div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-2">{selectedChar.pinyin}</h2>
                                    <p className="text-gray-500 text-lg mb-8 text-center px-4">{selectedChar.meaning}</p>
                                    <div className="relative w-64 h-64 border-4 border-red-800 bg-red-50 mb-8 select-none flex items-center justify-center">
                                        <div className="absolute w-full h-[1px] bg-red-300 top-1/2 transform -translate-y-1/2 border-t border-dashed border-red-800 opacity-50"></div>
                                        <div className="absolute h-full w-[1px] bg-red-300 left-1/2 transform -translate-x-1/2 border-l border-dashed border-red-800 opacity-50"></div>
                                        <span className="text-[180px] leading-none font-serif text-black z-10 font-kaiti">{selectedChar.hanzi}</span>
                                    </div>
                                    <a href={`https://www.mdbg.net/chinese/dictionary?page=worddict&wdrst=0&wdqti=0&wdqtm=0&wdqcham=1&wdqt=${selectedChar.hanzi}`} target="_blank" rel="noopener noreferrer" className="bg-indigo-600 text-white p-4 rounded-lg flex items-center justify-center gap-2 hover:bg-indigo-700 transition"><span>Hareketli Yazılışı Gör (MDBG)</span><ExternalLink size={16} /></a>
                                </div>
                            ) : (
                                <div className="text-center text-gray-400">
                                    <PenTool size={64} className="mx-auto mb-4 opacity-20" />
                                    <p className="text-lg">Soldan bir kelime seçin.</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-100 p-2 md:p-8 font-sans text-slate-800">
                    <header className="max-w-6xl mx-auto mb-8 text-center">
                        <h1 className="text-3xl md:text-4xl font-bold text-indigo-900 mb-2">Çince Çalışma Sistemi</h1>
                        <p className="text-gray-600">Road to Success & HSK 1-6 Sözlük</p>
                    </header>
                    <div className="max-w-6xl mx-auto bg-white rounded-2xl shadow-sm overflow-hidden min-h-[600px]">
                        <div className="flex flex-wrap border-b">
                            <button onClick={() => setActiveTab('flashcards')} className={`flex-1 py-4 px-2 min-w-[100px] flex items-center justify-center gap-2 font-medium transition ${activeTab === 'flashcards' ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50' : 'text-gray-500 hover:text-indigo-500'}`}><BookOpen size={20} /><span className="hidden sm:inline ml-2">Flashcards</span></button>
                            <button onClick={() => setActiveTab('sentences')} className={`flex-1 py-4 px-2 min-w-[100px] flex items-center justify-center gap-2 font-medium transition ${activeTab === 'sentences' ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50' : 'text-gray-500 hover:text-indigo-500'}`}><Layers size={20} /><span className="hidden sm:inline ml-2">Cümle Kurma</span></button>
                            <button onClick={() => setActiveTab('quiz')} className={`flex-1 py-4 px-2 min-w-[100px] flex items-center justify-center gap-2 font-medium transition ${activeTab === 'quiz' ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50' : 'text-gray-500 hover:text-indigo-500'}`}><HelpCircle size={20} /><span className="hidden sm:inline ml-2">Quiz</span></button>
                            <button onClick={() => setActiveTab('hsk')} className={`flex-1 py-4 px-2 min-w-[100px] flex items-center justify-center gap-2 font-medium transition ${activeTab === 'hsk' ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50' : 'text-gray-500 hover:text-indigo-500'}`}><Database size={20} /><span className="hidden sm:inline ml-2">HSK Sözlük (5000+)</span></button>
                        </div>
                        <div className="p-4 md:p-8 bg-slate-50 min-h-[500px]">
                            {activeTab === 'flashcards' && <Flashcards />}
                            {activeTab === 'sentences' && <SentenceBuilder />}
                            {activeTab === 'quiz' && <Quiz />}
                            {activeTab === 'hsk' && <HSKDictionary />}
                        </div>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<ChineseStudySystem />);
    </script>
</body>
</html>